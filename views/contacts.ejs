<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Cuba admin is super flexible, powerful, clean &amp; modern responsive bootstrap 5 admin template with unlimited possibilities.">
  <meta name="keywords"
    content="admin template, Cuba admin template, dashboard template, flat admin template, responsive admin template, web app">
  <meta name="author" content="pixelstrap">
  <link rel="icon" href="../assets/images/favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="../assets/images/favicon.png" type="image/x-icon">
  <title>Cuba - Premium Admin Template</title>
  <!-- Google font-->
  <link href="https://fonts.googleapis.com/css?family=Rubik:400,400i,500,500i,700,700i&amp;display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,700,700i,900&amp;display=swap"
    rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="../assets/css/font-awesome.css">
  <!-- ico-font-->
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/icofont.css">
  <!-- Themify icon-->
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/themify.css">
  <!-- Flag icon-->
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/flag-icon.css">
  <!-- Feather icon-->
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/feather-icon.css">
  <!-- Plugins css start-->
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/slick.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/slick-theme.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/scrollbar.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/animate.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/select2.css">
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/sweetalert2.css">
  <!-- Plugins css Ends-->
  <!-- Bootstrap css-->
  <link rel="stylesheet" type="text/css" href="../assets/css/vendors/bootstrap.css">
  <!-- App css-->
  <link rel="stylesheet" type="text/css" href="../assets/css/style.css">
  <link id="color" rel="stylesheet" href="../assets/css/color-1.css" media="screen">
  <!-- Responsive css-->
  <link rel="stylesheet" type="text/css" href="../assets/css/responsive.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  
</head>

<body>
  <!-- loader starts-->
  <div class="loader-wrapper">
    <div class="loader-index"> <span></span></div>
    <svg>
      <defs></defs>
      <filter id="goo">
        <fegaussianblur in="SourceGraphic" stddeviation="11" result="blur"></fegaussianblur>
        <fecolormatrix in="blur" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo"> </fecolormatrix>
      </filter>
    </svg>
  </div>
  <!-- loader ends-->
  <!-- tap on top starts-->
  <div class="tap-top"><i data-feather="chevrons-up"></i></div>
  <!-- tap on tap ends-->
  <!-- page-wrapper Start-->
  <div class="page-wrapper compact-wrapper" id="pageWrapper">
    <!-- Page Header Start-->
    <%- include('header', { mobile_number: mobile_number }) -%>
    <!-- Page Header Ends-->
      <!-- Page Body Start-->
      <div class="page-body-wrapper">
        <!-- Page Sidebar Start-->
        <%- include('sidebarpannel'); -%>
          <!-- Page Sidebar Ends-->
          <div class="page-body">
            <div class="container-fluid">
              <div class="page-title">
                <div class="row">
                  <div class="col-6">
                    <h3>Contacts</h3>
                  </div>
                  <div class="col-6">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="index.html">                                       
                          <svg class="stroke-icon">
                            <use href="../assets/svg/icon-sprite.svg#stroke-home"></use>
                          </svg></a></li>
                      <li class="breadcrumb-item">Apps</li>
                      <li class="breadcrumb-item active">Contacts</li>
                    </ol>
                  </div>
                </div>
              </div>
            </div>
            <!-- Container-fluid starts-->
            <div class="container-fluid">
              <div class="email-wrap bookmark-wrap">
                <div class="row">
                  <div class="col-xl-18 col-md-12 box-col-18">
                    <div class="email-right-aside bookmark-tabcontent contacts-tabs">
                      <div class="card email-body radius-left dark-contact">
                        <div class="ps-0">
                          <div class="tab-content">
                            <div class="tab-pane fade active show" id="pills-personal" role="tabpanel" aria-labelledby="pills-personal-tab">
                              <div class="card mb-0">
                                
                                <div class="card-header d-flex">
                                  <!-- Placeholder for "Shiv" -->
                                  <div class="flex-start"><h5>Contacts [ 
                                    <span>
                                      <%= rows.length %>
                                    </span> ] 
                                  </h5></div>
                                  
                                  <!-- Success message -->
                                  <div id="successMessage" style="display: none; background-color: rgb(28, 199, 28); color: white; border-radius: 10px; padding: 5px;">
                                    Contact added successfully!
                                  </div>                                         
                                  
                                  <!-- Add button -->
                                  <button type="button" id="add_data" class="btn btn-success btn-sm float-end" data-bs-toggle="modal" data-bs-target="#exampleModal">Add</button>
                                 
                                </div>  

                                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                  <div class="modal-dialog">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Add Contact</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                      </div>
                                
                                      <div class="modal-body">
                                        <form id="addContactForm">
                                          <div class="mb-3">
                                            <label for="fullName" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="fullName" required>
                                          </div>
                                          <div class="mb-3">
                                            <label for="whatsappNumber" class="form-label">WhatsApp Number</label>
                                            <input type="text" class="form-control" id="whatsappNumber" required>
                                          </div>
                                        </form>
                                      </div>
                                      
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="button" class="btn btn-primary" id="addContactBtn">Add</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                

                                <span id="message"></span>
                                <div class="card-body p-0">
                                  <div class="row list-persons" id="addcon">
                                    <div class="col-xl-4 xl-50 col-md-5">
                                      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                        <% rows.forEach(function(eachData, index) { %>
                                          <a class="contact-tab-<%= index %> nav-link <%= index === 0 ? 'active' : '' %>"
                                            id="v-pills-user-tab-<%= index %>" 
                                            data-bs-toggle="pill"
                                            onclick="activeDiv(<%= index %>)" 
                                            href="#v-pills-user-<%= index %>"
                                            role="tab" aria-controls="v-pills-user"
                                            aria-selected="<%= index === 0 ? 'true' : 'false' %>">
                                            <div class="media">
                                              <div
                                                class="img-circle img-50 img-fluid m-r-20 rounded-circle update_img_<%= index %>"
                                                style="background-color: #007bff; color: #fff; text-align: center; line-height: 50px; font-size: 20px;">
                                                <% const
                                                nameParts=eachData.full_name.split(' ');
                                                const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('');
                                                %>
                                                <%= initials %>
                                              </div>
                                                <div class="media-body">
                                                  <h6>
                                                    <span class="full_name<%= index %>"> <%= eachData.full_name %> </span>
                                                  </h6>
                                                  <p class="whatsapp_number<%= index %>"><%= eachData.whatsapp_number %></p>
                                                </div>
                                            </div>
                                          </a>
                                        <% }); %>
                                      </div>
                                    </div>
                                    <div class="col-xl-8 xl-50 col-md-7">
                                      <div class="tab-content">
                                        <% rows.forEach(function(eachData, index) { %>
                                          <div class="tab-pane contact-tab-<%= index %> fade <%= index === 0 ? ' show active' : '' %>" id="v-pills-user-<%=index %>" role="tabpanel" aria-labelledby="v-pills-user-tab-<%=index %>">
                                            <div class="profile-mail">
                                              <div class="media">
                                                <div class="img-circle img-50 img-fluid m-r-20 rounded-circle update_img_<%= index %>" style="background-color: #007bff; color: #fff; text-align: center; line-height: 50px; font-size: 20px;">
                                                  <% const nameParts = eachData.full_name.split(' ');
                                                  const initials = nameParts.map(part => part.charAt(0).toUpperCase()).join('');
                                                  %>
                                                  <%= initials %>
                                                </div>
                                                <div class="media-body mt-0">
                                                  <h5>
                                                    <span class="full_name<%= index %>"> <%= eachData.full_name %> </span>
                                                  </h5>
                                                  <p class="whatsapp_number<%= index %>"> <%= eachData.whatsapp_number %> </p>
                                                  <ul>
                                                    <li>
                                                      <a href="#" class="editContactLink text-success" data-index="<%= index %>" data-bs-toggle="modal" data-bs-target="#editModal">Edit</a>                                                                                                                                                       
                                                      
                                                     
                                                    </li>
                                                    <li>
                                                      <a href="#" onclick="deleteContact(<%= index %>)">Delete</a>
                                                    </li>
                                                    <li>
                                                      <a href="#" onclick="history(<%= index %>)">History</a>
                                                    </li>
                                                    <li>
                                                      <a href="#" onclick="printContact(<%= index %>)" data-bs-toggle="modal" data-bs-target="#printModal">Print</a>
                                                    </li>
                                                  </ul>
                                                </div>
                                              </div>
                                              <div class="email-general">
                                                <h6 class="mb-3">General</h6>
                                                <ul>
                                                  <li>Full Name <span class="font-primary"> <%= eachData.full_name %> </span></li>
                                                  <li>Whatsapp number <span class="font-primary"> <%= eachData.whatsapp_number %> </span></li>
                                                  <li>Gender <span class="font-primary"> <%= eachData.gender %> </span></li>
                                                  <li>Birthday <span class="font-primary"> <%= eachData.dob %> </span></li>
                                                  <li>Address <span class="font-primary"> <%= eachData.address %> </span></li>
                                                  <li>City <span class="font-primary"> <%= eachData.city %> </span></li>
                                                  <li>State <span class="font-primary"> <%= eachData.state %> </span></li>
                                                  <li>Country <span class="font-primary"> <%= eachData.country %> </span></li>
                                                  <li>Pincode <span class="font-primary"> <%= eachData.pincode %> </span></li>

                                                </ul>
                                              </div>
                                            </div>
                                          </div>
                                        <% }); %>
                                      </div>
                                      
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <!-- tab panel end -->
                                      <!-- edit -->
                                <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
                                  <div class="modal-dialog">
                                    <div class="modal-content">
                                      <div class="modal-header">
                                        <h5 class="modal-title" id="editModalLabel">Edit Contact</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                      </div>
                                
                                      <div class="modal-body">
                                        <form id="addContactForm">
                                          <div class="mb-3">
                                            <label for="fullName" class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="editFullName" required>
                                          </div>
                                          <div class="mb-3">
                                            <label for="whatsappNumber" class="form-label">WhatsApp Number</label>
                                            <input type="text" class="form-control" id="editWhatsappNumber" required>
                                          </div>

                                          <div class="mb-3">                
                                            <div class="mt-0 mb-3 col-md-15">
                                              <div class="row">
                                                <div class="col-sm-3">
                                                  <label>Gender</label>
                                                  <div class="d-block">
                                                      <label class="me-3" for="editgender_male">
                                                          <input class="radio_animated" id="editgender_male" type="radio" name="editGender" checked>
                                                          <span>Male</span>                                          
                                                      </label>
                                                      <label for="editgender_female">
                                                          <input class="radio_animated" id="editgender_female" type="radio" name="editGender">
                                                          <span>Female</span>
                                                      </label>
                                                  </div>
                                              </div>
                                              
                                          
                                                <div class="col-sm-9">
                                                  <label>DOB</label>
                                                  <div class="row">
                                                    <div class="col-lg-3 col-sm-5">
                                                      <select class="form-control" id="editbirth_day">
                                                        <option class="f-w-600">Day</option>
                                                        <option>01</option>
                                                        <option>02</option>
                                                        <option>03</option>
                                                        <option>04</option>
                                                        <option>05</option>
                                                        <option>06</option>
                                                        <option>07</option>
                                                        <option>08</option>
                                                        <option>09</option>
                                                        <option>10</option>
                                                        <option>11</option>
                                                        <option>12</option>
                                                        <option>13</option>
                                                        <option>14</option>
                                                        <option>15</option>
                                                        <option>16</option>
                                                        <option>17</option>
                                                        <option>18</option>
                                                        <option>19</option>
                                                        <option>20</option>
                                                        <option>21</option>
                                                        <option>22</option>
                                                        <option>23</option>
                                                        <option>24</option>
                                                        <option>25</option>
                                                        <option>26</option>
                                                        <option>27</option>
                                                        <option>28</option>
                                                        <option>29</option>
                                                        <option>30</option>
                                                        <option>31</option>
                                                      </select>
                                                    </div>
                                                    <div class="col-lg-3 col-sm-4">
                                                      <select class="form-control" id="editbirth_month">
                                                        <option class="f-w-600">Month</option>
                                                        <option>January</option>
                                                        <option>February</option>
                                                        <option>March</option>
                                                        <option>April</option>
                                                        <option>May</option>
                                                        <option>June</option>
                                                        <option>July</option>
                                                        <option>August</option>
                                                        <option>September</option>
                                                        <option>October</option>
                                                        <option>November</option>
                                                        <option>December</option>
                                                      </select>
                                                    </div>
                                                    <div class="col-lg-3 col-sm-4">
                                                      <input class="form-control" id="editbirth_year" type="text">
                                                    </div>
                                                  </div>
                                                 </div>
                                              </div>
                                            </div>
                                          </div>

                                          

                                          <div class="mb-3 col-md-12">
                                            <div class="row">
                                              <div class="col-12">
                                                <div class="mb-2">
                                                  <label for="address" class="form-label">Address</label>
                                                  <input type="text" class="form-control" id="editAddress" required>
                                                </div>
                                              </div>
                                              <div class="col-sm-6">
                                                <div class="mb-2">
                                                  <label for="city" class="form-label">City</label>
                                                  <input type="text" class="form-control" id="editCity" required>
                                                </div>
                                              </div>
                                              <div class="col-sm-6">
                                                <div class="mb-2">
                                                  <label for="state" class="form-label">State</label>
                                                  <input class="form-control" type="text" id="editState" required>
                                                </div>
                                              </div>
                                              <div class="col-sm-6">
                                                <div>
                                                  <label for="state" class="form-label">Country</label>
                                                  <input class="form-control" type="text" id="editCountry" required>
                                                </div>
                                              </div>
                                              <div class="col-sm-6">
                                                <div>
                                                  <label for="pincode" class="form-label">Pincode</label>
                                                  <input class="form-control" type="text" id="editPincode" required>
                                                </div>
                                              </div>
                                            </div>
                                          </div>
                                                                                   
                                        </form>
                                      </div>



                                      
                                      <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="button" class="btn btn-primary" id="saveContactBtn">Save</button>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                          


                            <div class="fade tab-pane" id="pills-organization" role="tabpanel" aria-labelledby="pills-organization">
                              <div class="card mb-0">
                                <div class="card-header d-flex">
                                  <h5>Organization</h5><span class="f-14 pull-right mt-0">10 Contacts</span>
                                </div>
                                <div class="card-body p-0">
                                </div>
                              </div>
                            </div>

                            <div id="right-history">
                              <div class="modal-header p-l-20 p-r-20">
                                <h6 class="modal-title w-100">Contact History<span class="pull-right"><a class="closehistory" href="#"><i class="icofont icofont-close"></i></a></span></h6>
                              </div>
                              <div class="history-details">
                                <div class="text-center"><i class="icofont icofont-ui-edit"></i>
                                  <p>Contact has not been modified yet.</p>
                                </div>
                                <div class="media"><i class="icofont icofont-star me-3"></i>
                                  <div class="media-body mt-0">
                                    <h6 class="mt-0">Contact Created</h6>
                                    <p class="mb-0">Contact is created via mail</p><span class="f-12">Sep 10, 2019 4:00</span>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="modal fade modal-bookmark" id="printModal" tabindex="-1" role="dialog" aria-hidden="true">
                              <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <h5 class="modal-title">Print preview</h5>
                                    <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
                                  </div>
                                  <div class="modal-body list-persons">
                                    <div class="profile-mail pt-0" id="DivIdToPrint">
                                      <div class="media"><img class="img-100 img-fluid m-r-20 rounded-circle" id="updateimg" src="../assets/images/user/2.png" alt="">
                                        <div class="media-body mt-0">
                                          <h5><span id="printname">Bucky </span><span id="printlast">Barnes</span></h5>
                                          <p id="printmail">barnes@gmail.com</p>
                                        </div>
                                      </div>
                                      <div class="email-general">
                                        <h6>General</h6>
                                        <p>Email Address: <span class="font-primary" id="mailadd">barnes@gmail.com   </span></p>
                                      </div>
                                    </div>
                                    <button class="btn btn-secondary" id="btnPrint" type="button" onclick="printDiv();">Print</button>
                                    <button class="btn btn-primary" type="button" data-bs-dismiss="modal">Cancel</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- Container-fluid Ends-->
          </div>
          <!-- footer start-->
          <footer>
            <%- include('footer'); -%>
          </footer>
      </div>
  </div>
                    
<!-- latest jquery-->
<script src="../assets/js/jquery.min.js"></script>
<!-- Bootstrap js-->
<script
  src="../assets/js/bootstrap/bootstrap.bundle.min.js"></script>
<!-- feather icon js-->
<script
  src="../assets/js/icons/feather-icon/feather.min.js"></script>
<script
  src="../assets/js/icons/feather-icon/feather-icon.js"></script>
<!-- scrollbar js-->
<script src="../assets/js/scrollbar/simplebar.js"></script>
<script src="../assets/js/scrollbar/custom.js"></script>
<!-- Sidebar jquery-->
<script src="../assets/js/config.js"></script>
<!-- Plugins JS start-->
<script src="../assets/js/sidebar-menu.js"></script>
<script src="../assets/js/sidebar-pin.js"></script>
<script src="../assets/js/slick/slick.min.js"></script>
<script src="../assets/js/slick/slick.js"></script>
<script src="../assets/js/header-slick.js"></script>
<script
  src="../assets/js/notify/bootstrap-notify.min.js"></script>
<script
  src="../assets/js/sweet-alert/sweetalert.min.js"></script>
<script src="../assets/js/select2/select2.full.min.js"></script>
<script src="../assets/js/select2/select2-custom.js"></script>
<script src="../assets/js/form-validation-custom.js"></script>
<script
  src="../assets/js/bookmark/jquery.validate.min.js"></script>
<script src="../assets/js/contacts/custom.js"></script>
<!-- Plugins JS Ends-->
<!-- Theme js-->
<script src="../assets/js/script.js"></script>
<script
  src="../assets/js/theme-customizer/customizer.js"></script>
<script
  src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
 
  $(document).ready(function () {

    // Add event listener to the "Add" button in the modal

    $('#addContactBtn').click(function () {
      // Get values from the form
      var fullName = $('#fullName').val();
      var whatsappNumber = $('#whatsappNumber').val();

      // Prepare data to be sent via AJAX
      var data = {
        fullName: fullName,
        whatsappNumber: whatsappNumber
      };

      // Send AJAX POST request to the server
      event.preventDefault();
      $.ajax({
        type: 'POST',
        url: '/add_contact', // URL to your server route for adding contacts
        data: data,
        success: function (response) {
          // Handle success response
          console.log(response);
          // Optionally, you can update the UI or perform other actions here

          // Display success message
          $('#successMessage').fadeIn().delay(2000).fadeOut(); // Show message for 2 seconds

        },
        error: function (error) {
          // Handle error response
          console.error('Error:', error);
        }
      });

      // Close the modal
      $('#exampleModal').modal('hide');
    });


    $(document).on('click', '.editContactLink', function () {
      console.log("Edit button clicked"); // Debugging statement
      // Get the index of the user
      var index = $(this).data('index');
      var contactId = ''; // Declare contactId variable here
      console.log(index);
      // Make an AJAX request to fetch the contact details
      $.ajax({
          method: 'POST', // Specify the HTTP method as POST
          url: '/contacts/' + index, // Pass the index to the route
          data: { index: index, action: 'fetch' }, // Include data to be sent to the server
          dataType: 'json', // Specify the expected data type of the response
          success: function (contactData) {
              // Populate the form fields with the contact's details
              $('#editFullName').val(contactData.full_name);
              $('#editWhatsappNumber').val(contactData.whatsapp_number);
              // Set gender
              $('input[name="rdo-ani"]').prop('checked', false); // Uncheck all first
              if (contactData.gender === 'Male') {
                  $('#editgender_male').prop('checked', true);
              } else {
                  $('#editgender_female').prop('checked', true);
              }
              // Set DOB
              var dob = new Date(contactData.dob);
              $('#editbirth_day').val(dob.getDate());
              $('#editbirth_month').val(dob.getMonth() + 1); // Months are zero-based
              $('#editbirth_year').val(dob.getFullYear());
              $('#editAddress').val(contactData.address);
              $('#editCity').val(contactData.city);
              $('#editState').val(contactData.state);
              $('#editCountry').val(contactData.country);
              $('#editPincode').val(contactData.pincode);
              contactId = contactData.id; // Store the contactId in the variable
              $('#saveContactBtn').data('contactId', contactId);
          },
          error: function (error) {
              console.error('Error fetching contact details:', error);
              // Handle error appropriately, e.g., show an alert
          }
      });
  });
    
      
  
    
      // Event listener for the "Save" button in the edit modal
      $('#saveContactBtn').click(function () {
        // Capture the updated data from the form fields
        var fullName = $('#editFullName').val();
        var whatsappNumber = $('#editWhatsappNumber').val();
        var contactId = $(this).data('contactId'); // Retrieve contactId from data attribute
        
        // Make an AJAX request to update the contact data
        $.ajax({
            type: 'PUT', // Use PUT method for update operation
            url: '/update-contact', // Route for updating contact data
            data: {
                contactId: contactId,
                fullName: fullName,
                whatsappNumber: whatsappNumber,
                // Add more fields if needed
            },
            success: function (response) {
                // Handle success response
                console.log('Contact updated successfully');
                // Optionally, close the edit modal or perform other actions
            },
            error: function (error) {
                // Handle error response
                console.error('Error updating contact:', error);
                // Optionally, show an error message to the user
            }
        });
      });
      
  
    

    
  });


    



  
</script>
</body>
</html>